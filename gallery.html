<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gallery — Assam Horizon Sr. Secondary School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
      /* Category Section Styling */
      .category-section {
        margin-bottom: 3rem;
      }
      
      .category-header {
        margin-bottom: 1.5rem;
      }
      
      .category-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 0.5rem;
      }
      
      .category-description {
        color: #666;
        font-size: 1rem;
      }
      
      /* Horizontal Scrollable Carousel */
      .gallery-carousel {
        display: flex;
        overflow-x: auto;
        overflow-y: hidden;
        gap: 1rem;
        padding: 1rem 0;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
      }
      
      /* Hide scrollbar but keep functionality */
      .gallery-carousel::-webkit-scrollbar {
        height: 8px;
      }
      
      .gallery-carousel::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      
      .gallery-carousel::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      
      .gallery-carousel::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      
      /* Gallery Card */
      .gallery-card {
        flex: 0 0 auto;
        width: 280px;
        height: 200px;
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      .gallery-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      }
      
      .gallery-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }
      
      .gallery-card:hover img {
        transform: scale(1.05);
      }
      
      .gallery-card-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        color: white;
        padding: 1rem;
        transform: translateY(100%);
        transition: transform 0.3s ease;
      }
      
      .gallery-card:hover .gallery-card-overlay {
        transform: translateY(0);
      }
      
      .gallery-card-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin: 0;
      }
      
      .gallery-card-description {
        font-size: 0.8rem;
        margin: 0;
        opacity: 0.9;
      }
      
      /* No images in category */
      .no-category-images {
        padding: 2rem;
        text-align: center;
        background: #f8f9fa;
        border-radius: 8px;
        color: #6c757d;
      }
      
      /* Scroll indicators */
      .scroll-indicator {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255,255,255,0.9);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        z-index: 10;
        transition: all 0.3s ease;
      }
      
      .scroll-indicator:hover {
        background: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      
      .scroll-indicator.left {
        left: -20px;
      }
      
      .scroll-indicator.right {
        right: -20px;
      }
      
      .carousel-wrapper {
        position: relative;
      }
    </style>
  </head>
  <body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">
          Assam Horizon <span class="brand-accent"> Sr. Secondary School</span>
        </a>
        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="academics.html">Academics</a></li>
            <li class="nav-item"><a class="nav-link" href="admissions.html">Admissions</a></li>
            <li class="nav-item"><a class="nav-link" href="faculty.html">Faculty</a></li>
            <li class="nav-item"><a class="nav-link active" href="gallery.html">Gallery</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Portals</a>
              <ul class="dropdown-menu dropdown-menu-end">
                <!-- <li><a class="dropdown-item" href="portal.html">Academics Portal</a></li> -->
                <!-- <li><a class="dropdown-item" href="parent-portal.html">Parent Portal</a></li> -->
                <li><a class="dropdown-item" href="admin.html">Admin Backend</a></li>
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="notice.html">Notice Board</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="py-5">
      <div class="container">
        <div class="text-center mb-5">
          <h1 class="fw-bold">Gallery</h1>
          <p class="text-secondary">Explore moments from our vibrant school life</p>
        </div>

        <!-- Loading Spinner -->
        <div id="galleryLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading gallery images...</p>
        </div>

        <!-- No Images Message -->
        <div id="noImages" class="text-center py-5" style="display: none;">
          <i class="fas fa-images fa-3x text-muted mb-3"></i>
          <h4 class="text-muted">No gallery images available</h4>
          <p class="text-muted">Check back later for updates.</p>
        </div>

        <!-- Gallery Categories -->
        <div id="galleryCategories" style="display: none;">
          <!-- Category sections will be dynamically loaded here -->
        </div>
      </div>

      <!-- Lightbox Modal -->
      <div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content bg-dark">
            <div class="modal-body p-0">
              <img id="lightboxImg" alt="Lightbox" class="img-fluid w-100" />
            </div>
            <div class="modal-footer border-0">
              <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="site-footer py-4 mt-auto">
      <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
        <div>© <span id="year"></span> Assam Horizon Sr. Secondary School</div>
        <div class="d-flex gap-3">
          <a href="notice.html">Notice Board</a>
          <a href="contact.html">Contact</a>
          <a href="admissions.html">Admissions</a>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabaseClient.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
      // Set current year in footer
      document.getElementById("year").textContent = new Date().getFullYear();

      // Load gallery images on page load
      function waitForSupabaseAndLoad() {
        const client = window.getSupabaseClient();
        if (client) {
          loadGalleryImages();
        } else {
          // Wait for Supabase to be ready
          const timeout = setTimeout(function() {
            const client = window.getSupabaseClient();
            if (client) {
              loadGalleryImages();
            } else {
              const loadingDiv = document.getElementById('galleryLoading');
              if (loadingDiv) {
                loadingDiv.innerHTML = '<div class="alert alert-danger">Error: Failed to initialize database connection. Please refresh the page.</div>';
              }
            }
          }, 3000);

          window.addEventListener('supabaseReady', function() {
            clearTimeout(timeout);
            loadGalleryImages();
          }, { once: true });
        }
      }

      document.addEventListener('DOMContentLoaded', waitForSupabaseAndLoad);

      // Category definitions
      const categories = {
        academics: {
          title: 'Academics & Classroom Life',
          description: 'Learning moments, projects, experiments, reading time',
          icon: 'fa-graduation-cap',
          color: '#0d6efd'
        },
        sports: {
          title: 'Sports & Physical Activities',
          description: 'Sports day, matches, yoga, drills, fitness activities',
          icon: 'fa-trophy',
          color: '#198754'
        },
        cultural: {
          title: 'Cultural & Celebrations',
          description: 'Festivals, annual day, assemblies, music, dance, art events',
          icon: 'fa-palette',
          color: '#dc3545'
        },
        trips: {
          title: 'Trips & Outdoor Learning',
          description: 'Field trips, excursions, nature walks, educational visits',
          icon: 'fa-bus',
          color: '#fd7e14'
        },
        achievements: {
          title: 'Achievements & Special Moments',
          description: 'Awards, certificates, competitions, milestones, proud moments',
          icon: 'fa-medal',
          color: '#ffc107'
        }
      };

      // Function to load gallery images from Supabase
      async function loadGalleryImages() {
        const supabase = window.getSupabaseClient();
        if (!supabase) {
          console.error('Supabase client not available');
          return;
        }

        const loadingDiv = document.getElementById('galleryLoading');
        const noImagesDiv = document.getElementById('noImages');
        const galleryCategoriesDiv = document.getElementById('galleryCategories');

        try {
          loadingDiv.style.display = 'block';
          noImagesDiv.style.display = 'none';
          galleryCategoriesDiv.style.display = 'none';

          // Fetch gallery images from Supabase
          const { data: images, error } = await supabase
            .from('gallery')
            .select('*')
            .order('display_order', { ascending: true });

          if (error) {
            throw error;
          }

          loadingDiv.style.display = 'none';

          if (!images || images.length === 0) {
            noImagesDiv.style.display = 'block';
            return;
          }

          // Group images by category
          const imagesByCategory = {};
          images.forEach(image => {
            const cat = image.category || 'general';
            if (!imagesByCategory[cat]) {
              imagesByCategory[cat] = [];
            }
            imagesByCategory[cat].push(image);
          });

          // Build HTML for each category
          let categoriesHTML = '';
          
          // Display categories in order
          Object.keys(categories).forEach(categoryKey => {
            const categoryInfo = categories[categoryKey];
            const categoryImages = imagesByCategory[categoryKey] || [];
            
            // Always show category even if empty (for better UX)
            categoriesHTML += `
              <div class="category-section">
                <div class="category-header">
                  <h2 class="category-title">
                    <i class="fas ${categoryInfo.icon} me-2" style="color: ${categoryInfo.color}"></i>
                    ${categoryInfo.title}
                  </h2>
                  <p class="category-description">${categoryInfo.description}</p>
                </div>
                ${categoryImages.length > 0 ? `
                  <div class="carousel-wrapper">
                    <div class="gallery-carousel" id="carousel-${categoryKey}">
                      ${categoryImages.map(image => `
                        <div class="gallery-card" 
                             data-gallery="image" 
                             data-image-url="${image.image_url}"
                             data-title="${escapeHtml(image.title)}"
                             data-description="${escapeHtml(image.description || '')}"
                             data-category="${escapeHtml(categoryKey)}">
                          <img src="${image.image_url}" 
                               alt="${escapeHtml(image.title)}" 
                               loading="lazy" />
                          <div class="gallery-card-overlay">
                            <p class="gallery-card-title">${escapeHtml(image.title)}</p>
                            ${image.description ? `<p class="gallery-card-description">${escapeHtml(image.description)}</p>` : ''}
                          </div>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                ` : `
                  <div class="no-category-images">
                    <i class="fas fa-images fa-2x mb-2"></i>
                    <p class="mb-0">No images in this category yet. Check back soon!</p>
                  </div>
                `}
              </div>
            `;
          });

          galleryCategoriesDiv.innerHTML = categoriesHTML;
          galleryCategoriesDiv.style.display = 'block';

          // Initialize lightbox functionality
          initializeLightbox();

        } catch (error) {
          console.error('Error loading gallery images:', error);
          loadingDiv.style.display = 'none';
          galleryCategoriesDiv.innerHTML = `
            <div class="col-12 text-center">
              <div class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error loading gallery images. Please try again later.
              </div>
            </div>
          `;
          galleryCategoriesDiv.style.display = 'block';
        }
      }

      // Function to initialize lightbox functionality
      function initializeLightbox() {
        const galleryCards = document.querySelectorAll('[data-gallery="image"]');
        const lightboxModal = document.getElementById('lightboxModal');
        const lightboxImg = document.getElementById('lightboxImg');

        galleryCards.forEach(card => {
          card.addEventListener('click', function() {
            const imageUrl = this.dataset.imageUrl;
            const title = this.dataset.title;
            const description = this.dataset.description;
            
            lightboxImg.src = imageUrl;
            lightboxImg.alt = title;
            
            // You can add a title element to the modal if needed
            const modal = new bootstrap.Modal(lightboxModal);
            modal.show();
          });
        });
      }

      // Function to escape HTML to prevent XSS
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Auto-refresh gallery every 5 minutes
      setInterval(loadGalleryImages, 300000);
    </script>
  </body>
</html>




