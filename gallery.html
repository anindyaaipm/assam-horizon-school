<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gallery — Assam Horizon Sr. Secondary School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  </head>
  <body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">
          Assam Horizon <span class="brand-accent"> Sr. Secondary School</span>
        </a>
        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="academics.html">Academics</a></li>
            <li class="nav-item"><a class="nav-link" href="admissions.html">Admissions</a></li>
            <li class="nav-item"><a class="nav-link" href="faculty.html">Faculty</a></li>
            <li class="nav-item"><a class="nav-link active" href="gallery.html">Gallery</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Portals</a>
              <ul class="dropdown-menu dropdown-menu-end">
                <!-- <li><a class="dropdown-item" href="portal.html">Academics Portal</a></li> -->
                <!-- <li><a class="dropdown-item" href="parent-portal.html">Parent Portal</a></li> -->
                <li><a class="dropdown-item" href="admin.html">Admin Backend</a></li>
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="notice.html">Notice Board</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="py-5">
      <div class="container">
        <div class="text-center mb-4">
          <h1 class="fw-bold">Gallery</h1>
          <p class="text-secondary">Highlights from campus life and events.</p>
        </div>

        <!-- Loading Spinner -->
        <div id="galleryLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading gallery images...</p>
        </div>

        <!-- No Images Message -->
        <div id="noImages" class="text-center py-5" style="display: none;">
          <i class="fas fa-images fa-3x text-muted mb-3"></i>
          <h4 class="text-muted">No gallery images available</h4>
          <p class="text-muted">Check back later for updates.</p>
        </div>

        <!-- Gallery Grid -->
        <div id="galleryGrid" class="gallery-grid" style="display: none;">
          <!-- Images will be dynamically loaded here -->
        </div>
      </div>

      <!-- Lightbox Modal -->
      <div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content bg-dark">
            <div class="modal-body p-0">
              <img id="lightboxImg" alt="Lightbox" class="img-fluid w-100" />
            </div>
            <div class="modal-footer border-0">
              <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="site-footer py-4 mt-auto">
      <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
        <div>© <span id="year"></span> Assam Horizon Sr. Secondary School</div>
        <div class="d-flex gap-3">
          <a href="notice.html">Notice Board</a>
          <a href="contact.html">Contact</a>
          <a href="admissions.html">Admissions</a>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="assets/js/main.js"></script>
    <script>
      // Supabase configuration
      const SUPABASE_URL = 'https://mrthnvwokprolhaoimpg.supabase.co'; // Replace with your Supabase URL
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ydGhudndva3Byb2xoYW9pbXBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNzExODYsImV4cCI6MjA3NDY0NzE4Nn0.5nncUpTZXKEMC65Bdcr5JRmzulUZRHWrRhPbVLV8Tzo'; // Replace with your Supabase anon key
      
      // Initialize Supabase client
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Set current year in footer
      document.getElementById("year").textContent = new Date().getFullYear();

      // Load gallery images on page load
      document.addEventListener('DOMContentLoaded', function() {
        loadGalleryImages();
      });

      // Function to load gallery images from Supabase
      async function loadGalleryImages() {
        const loadingDiv = document.getElementById('galleryLoading');
        const noImagesDiv = document.getElementById('noImages');
        const galleryGrid = document.getElementById('galleryGrid');

        try {
          loadingDiv.style.display = 'block';
          noImagesDiv.style.display = 'none';
          galleryGrid.style.display = 'none';

          // Fetch gallery images from Supabase
          const { data: images, error } = await supabase
            .from('gallery')
            .select('*')
            .eq('is_active', true)
            .order('display_order', { ascending: true });

          if (error) {
            throw error;
          }

          loadingDiv.style.display = 'none';

          if (!images || images.length === 0) {
            noImagesDiv.style.display = 'block';
            return;
          }

          // Display images
          galleryGrid.innerHTML = images.map(image => {
            return `
              <img data-gallery="image" 
                   src="${image.image_url}" 
                   alt="${escapeHtml(image.title)}"
                   title="${escapeHtml(image.title)}"
                   data-description="${escapeHtml(image.description || '')}"
                   data-category="${escapeHtml(image.category || '')}" />
            `;
          }).join('');

          galleryGrid.style.display = 'grid';

          // Initialize lightbox functionality
          initializeLightbox();

        } catch (error) {
          console.error('Error loading gallery images:', error);
          loadingDiv.style.display = 'none';
          galleryGrid.innerHTML = `
            <div class="col-12 text-center">
              <div class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error loading gallery images. Please try again later.
              </div>
            </div>
          `;
          galleryGrid.style.display = 'block';
        }
      }

      // Function to initialize lightbox functionality
      function initializeLightbox() {
        const images = document.querySelectorAll('[data-gallery="image"]');
        const lightboxModal = document.getElementById('lightboxModal');
        const lightboxImg = document.getElementById('lightboxImg');

        images.forEach(img => {
          img.addEventListener('click', function() {
            lightboxImg.src = this.src;
            lightboxImg.alt = this.alt;
            
            // Update modal title with image info
            const title = this.title || this.alt;
            const description = this.dataset.description;
            const category = this.dataset.category;
            
            let modalTitle = title;
            if (description) {
              modalTitle += ` - ${description}`;
            }
            if (category) {
              modalTitle += ` (${category})`;
            }
            
            // You can add a title element to the modal if needed
            const modal = new bootstrap.Modal(lightboxModal);
            modal.show();
          });
        });
      }

      // Function to escape HTML to prevent XSS
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Auto-refresh gallery every 5 minutes
      setInterval(loadGalleryImages, 300000);
    </script>
  </body>
</html>




